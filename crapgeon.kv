#: import DungeonStats game_stats.DungeonStats
#: import JerkyStats game_stats.JerkyStats
#: import CoffeeStats game_stats.CoffeeStats
#: import TobaccoStats game_stats.TobaccoStats
#: import WhiskyStats game_stats.WhiskyStats
#: import TalismanStats game_stats.TalismanStats

<DungeonLayout>:
    size_hint: None, None
    height: self.minimum_height
    width: self.minimum_width

<Label>:
    text_size: self.size    # needed to make halign work  
    halign: 'left'
    valign: 'center'
    font_size: '20sp'
    #padding: '20dp', '10dp', '20dp', '10dp'

<Button>:
    halign: 'center'
    disabled: True

<Tile>:
    background_normal: ''   # sets the background default to white instead of predefined grey
    background_color: 0.4, 0.8, 1, 1
    size_hint: None,None
    width: '55dp'
    height: self.width
    kind: None

    canvas:
        Color:
            rgba: (1,1,1,0.8) if not self.disabled else (1,1,1,1)

        Rectangle:  # draws the floor
            pos: self.pos
            size: self.size
            source: "./backgrounds/" + self.kind + 'background.png' if self.kind else None

<ProgressBar>:
    padding: '40dp'

<ScrollView>:
    effect_cls: 'ScrollEffect'  # avoids bouncing when reaching end of scroll


<MineMadnessGame>:
    on_active_character_id:
        name_label.text = str(root.active_character.name)
        ability_button.text = ability_button.display_text()

    on_level: level_label.text = "Depth: " + str(self.level * 30) + " ft."
    on_shovels: shovels_label.text = 'Shovels: ' + str(root.active_character.stats.shovels)
    on_weapons: weapons_label.text = 'Weapons: ' + str(root.active_character.stats.weapons)
    on_gems: gems_label.text = 'Gems: ' + str(root.active_character.gems) + '/' + str(root.total_gems)

    BoxLayout:
        orientation: 'vertical'
        padding: '5dp'

        # HEADER LABELS: CHARACTER NAME AND FLOOR NUMBER
        BoxLayout:
            padding: '5dp'
            orientation: 'horizontal'
            size_hint: 1, 0.1

            Label:
                id: name_label
                size_hint: 0.6, 1
                font_size: '23sp'

            AbilityButton:
                size_hint: 0.4, 1
                id: ability_button
                game: root

        # GUI: CHARACTER STATS AND INVENTORY
        BoxLayout:
            orientation: 'horizontal'
            size_hint: 1, 0.3
            padding: '5dp'

            #CHARACTER STATS
            BoxLayout:
                orientation: 'vertical'
                size_hint: 0.5,1
                spacing: '5dp'

                Label:
                    id: level_label
                Label:
                    id: weapons_label
                Label:
                    id: shovels_label
                Label:
                    id: gems_label

            #INVENTORY
            BoxLayout:
                orientation: 'vertical'
                size_hint: 0.5,1
                spacing: '5dp'

                JerkyButton:
                    text: "Jerky"
                    id: jerky_button
                    stats: JerkyStats()
                    game: root
                CoffeeButton:
                    text: "Coffee"
                    id: coffee_button
                    stats: CoffeeStats()
                    game: root
                TobaccoButton:
                    text: "Tobacco"
                    id: tobacco_button
                    stats: TobaccoStats()
                    game: root
                WhiskyButton:
                    text: "Whisky"
                    id: whisky_button
                    stats: WhiskyStats()
                    game: root
                TalismanButton:
                    text: "Talisman"
                    id: talisman_button
                    stats: TalismanStats()
                    game: root

        BoxLayout:
            size_hint: 1, 0.025
            padding: '5dp', '0dp','5dp','5dp'
            ProgressBar:
                max: 20
                value: 0
                id: experience_bar

        ScrollView:
            size_hint: 1, 0.575

            DungeonLayout:
                game: root
                dungeon_level: 1
                stats: DungeonStats(self.dungeon_level)
                rows: self.stats.size()
                cols: self.stats.size()
                blueprint: self.generate_blueprint(self.rows, self.cols)

<MainMenu>
    BoxLayout:
        orientation: "vertical"
        spacing: 10
        padding: '5dp', '0dp','5dp','5dp'

        Label:
            text: "Mine Madness"
            font_size: '40sp'
            text_size: self.size    # needed to make halign work
            halign: 'center'

        Button:
            text: "Start game"
            disabled: False
            on_release: app.root.current = "game"
        Button:
            text: "Continue"
            on_release: pass
        Button:
            text: "How to play"
            on_release: pass
        Button:
            text: "Music ON/OFF"
            on_release: pass
        Button:
            text: "Difficulty: Normal"
            on_release: pass
